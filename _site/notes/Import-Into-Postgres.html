<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Importing CSV Into Postgres</title><meta name="twitter:card" content="summary" /><meta name="twitter:site" content="@" /><meta name="twitter:title" content="Importing CSV Into Postgres" /><meta name="twitter:description" content="CSV to Postgres"><meta name="description" content="CSV to Postgres"><link rel="icon" href="/assets/favicon.png"><link rel="apple-touch-icon" href="/assets/touch-icon.png"><link rel="stylesheet" href="//code.cdn.mozilla.net/fonts/fira.css"><link rel="stylesheet" href="/assets/core.css"><link rel="canonical" href="/notes/Import-Into-Postgres"><link rel="alternate" type="application/atom+xml" title="Everything JS" href="/feed.xml" /></head><body><aside class="logo"> <a href="/"> <img src="http://i.imgur.com/lXpakuT.jpg?1" class="gravatar" width="80px"> </a> <span class="logo-prompt">Back to Home</span></aside><main> <noscript><style> article .footnotes { display: block; }</style></noscript><article><div class="center"><h1>Importing CSV Into Postgres</h1><time>February 5, 2016</time></div><div class="divider"></div><h3 id="csv-to-postgres">CSV to Postgres</h3><p>Often times it is exceedingly helpful to be able to seed a database with a ton of data. Conveniently, Postgres comes with a <code>copy</code> command that allows importing data into a table from a file, such as a .csv.</p><p>Inside the <code>psql</code> command line, enter the following:<br /> <code> COPY SOME_TABLE from 'FILE_PATH.csv' WITH DELIMITER ',' CSV HEADER; </code></p><h3 id="pre-reqs">Pre-reqs:</h3><ol><li>Access to <code>psql</code> interactive terminal</li><li>A table with <code>SOME_TABLE</code> already exists</li><li>A csv file exists at some <code>FILE_PATH.csv</code></li><li>The csv file headers matches the table column names</li></ol><h5 id="postgres-table-example">Postgres table example:</h5><p><code>CREATE TABLE SOME_TABLE (ID integer, NAME varchar);</code></p><h5 id="csv-file-example">CSV file example:</h5><table><thead><tr><th>id</th><th>name</th></tr></thead><tbody><tr><td>0</td><td>‘Kevin’</td></tr><tr><td>1</td><td>‘Alan’</td></tr><tr><td>2</td><td>‘Stephen’</td></tr></tbody></table><p>The <code>COPY</code> command copies the content of <code>FILE_PATH.csv</code> into <code>SOME_TABLE</code>, with commas as delimiters, using a csv file with headers.</p><p>Checkout Postgres <a href="http://www.postgresql.org/docs/9.3/static/sql-copy.html">docs</a> for detailed explainations of more advanced options.</p><p>This method assumes access to the psql interactive terminal.</p><h3 id="importing-in-node">Importing In Node</h3><p>Checkout the <a href="https://github.com/brianc/node-pg-copy-streams">pg-copy-streams</a> node module to import from a file while inside node.</p><p>This method allows importing without direct access to the Postgres interactive terminal.</p><p>Here’s an example use that copies from a file into the database:</p><pre><code class="language-javascript">var fs = require('fs');
var pg = require('pg');
var copyFrom = require('pg-copy-streams').from;

pg.connect(CONNECT_STR, function(err, client, done) {
  var stream = client.query(copyFrom('COPY my_table FROM STDIN'));
  var fileStream = fs.createReadStream('some_file.tsv')
  fileStream.on('error', done);
  fileStream.pipe(stream).on('finish', done).on('error', done);
});
</code></pre><p>Happy hacking!</p></article><div class="back"> <a href="/">Back</a></div></main></body></html>