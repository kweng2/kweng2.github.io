<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Importing CSV Into Postgres</title><meta name="twitter:card" content="summary" /><meta name="twitter:site" content="@" /><meta name="twitter:title" content="Importing CSV Into Postgres" /><meta name="twitter:description" content="CSV to Postgres"><meta name="description" content="CSV to Postgres"><link rel="icon" href="/assets/favicon.png"><link rel="apple-touch-icon" href="/assets/touch-icon.png"><link rel="stylesheet" href="//code.cdn.mozilla.net/fonts/fira.css"><link rel="stylesheet" href="/assets/core.css"><link rel="canonical" href="/notes/Import-Into-Postgres"><link rel="alternate" type="application/atom+xml" title="Everything JS" href="/feed.xml" /></head><body><aside class="logo"> <a href="/"> <img src="http://i.imgur.com/lXpakuT.jpg?1" class="gravatar" width="80px"> </a> <span class="logo-prompt">Back to Home</span></aside><main> <noscript><style> article .footnotes { display: block; }</style></noscript><article><div class="center"><h1>Importing CSV Into Postgres</h1><time>February 5, 2016</time></div><div class="divider"></div><h3 id="csv-to-postgres">CSV to Postgres</h3><p>Often times it is exceedingly helpful to be able to seed a database with a ton of data. Conveniently, Postgres comes with a <code class="highlighter-rouge">copy</code> command that allows importing data into a table from a file, such as a .csv.</p><p>Inside the <code class="highlighter-rouge">psql</code> command line, enter the following:<br /> <code class="highlighter-rouge"> COPY SOME_TABLE from 'FILE_PATH.csv' WITH DELIMITER ',' CSV HEADER; </code></p><h3 id="pre-reqs">Pre-reqs:</h3><ol><li>Access to <code class="highlighter-rouge">psql</code> interactive terminal</li><li>A table with <code class="highlighter-rouge">SOME_TABLE</code> already exists</li><li>A csv file exists at some <code class="highlighter-rouge">FILE_PATH.csv</code></li><li>The csv file headers matches the table column names</li></ol><h5 id="postgres-table-example">Postgres table example:</h5><p><code class="highlighter-rouge">CREATE TABLE SOME_TABLE (ID integer, NAME varchar);</code></p><h5 id="csv-file-example">CSV file example:</h5><table><thead><tr><th>id</th><th>name</th></tr></thead><tbody><tr><td>0</td><td>‘Kevin’</td></tr><tr><td>1</td><td>‘Alan’</td></tr><tr><td>2</td><td>‘Stephen’</td></tr></tbody></table><p>The <code class="highlighter-rouge">COPY</code> command copies the content of <code class="highlighter-rouge">FILE_PATH.csv</code> into <code class="highlighter-rouge">SOME_TABLE</code>, with commas as delimiters, using a csv file with headers.</p><p>Checkout Postgres <a href="http://www.postgresql.org/docs/9.3/static/sql-copy.html">docs</a> for detailed explainations of more advanced options.</p><p>This method assumes access to the psql interactive terminal.</p><h3 id="importing-in-node">Importing In Node</h3><p>Checkout the <a href="https://github.com/brianc/node-pg-copy-streams">pg-copy-streams</a> node module to import from a file while inside node.</p><p>This method allows importing without direct access to the Postgres interactive terminal.</p><p>Here’s an example use that copies from a file into the database:</p><div class="highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">pg</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'pg'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">copyFrom</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'pg-copy-streams'</span><span class="p">).</span><span class="nx">from</span><span class="p">;</span>

<span class="nx">pg</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">CONNECT_STR</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">stream</span> <span class="o">=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">copyFrom</span><span class="p">(</span><span class="s1">'COPY my_table FROM STDIN'</span><span class="p">));</span>
  <span class="kd">var</span> <span class="nx">fileStream</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="s1">'some_file.tsv'</span><span class="p">)</span>
  <span class="nx">fileStream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'error'</span><span class="p">,</span> <span class="nx">done</span><span class="p">);</span>
  <span class="nx">fileStream</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">stream</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'finish'</span><span class="p">,</span> <span class="nx">done</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'error'</span><span class="p">,</span> <span class="nx">done</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div><p>Happy hacking!</p></article><div class="back"> <a href="/">Back</a></div></main></body></html>