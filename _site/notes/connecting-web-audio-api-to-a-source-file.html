<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Connecting Web Audio API To A Source File</title><meta name="twitter:card" content="summary" /><meta name="twitter:site" content="@" /><meta name="twitter:title" content="Connecting Web Audio API To A Source File" /><meta name="twitter:description" content="In attempting to use the Web Audio API to visualize an audio file, I found plenty of helpful documents, particularly on the MDN documentation. I highly recommend spending some time reading through ..."><meta name="description" content="In attempting to use the Web Audio API to visualize an audio file, I found plenty of helpful documents, particularly on the MDN documentation. I highly recom..."><link rel="icon" href="/assets/favicon.png"><link rel="apple-touch-icon" href="/assets/touch-icon.png"><link rel="stylesheet" href="//code.cdn.mozilla.net/fonts/fira.css"><link rel="stylesheet" href="/assets/core.css"><link rel="canonical" href="/notes/connecting-web-audio-api-to-a-source-file"><link rel="alternate" type="application/atom+xml" title="Everything JS" href="/feed.xml" /></head><body><aside class="logo"> <a href="/"> <img src="http://i.imgur.com/lXpakuT.jpg?1" class="gravatar" width="80px"> </a> <span class="logo-prompt">Back to Home</span></aside><main> <noscript><style> article .footnotes { display: block; }</style></noscript><article><div class="center"><h1>Connecting Web Audio API To A Source File</h1><time>December 12, 2015</time></div><div class="divider"></div><p>In attempting to use the Web Audio API to visualize an audio file, I found plenty of helpful documents, particularly on the MDN documentation. I highly recommend spending some time reading through the relevant documentation before starting.</p><p>The examples on the MDN site are really helpful in understanding inputs, outputs, and purpose of each method, but I had trouble linking everything together. So here’s an example of visualizing a local sound file to a canvas element on a blank HTML page:</p><p><strong>First, let’s create an html audio tag:</strong></p><pre><code>&lt;audio controls&gt;
  &lt;source src = "sound.mp3" type = "audio/mpeg"&gt;
&lt;/audio&gt;
</code></pre><p><strong>Next</strong>, create a audio context somewhere in the JS script. Use that audio context to create a media source node by passing in the audio element:</p><pre><code class="language-javascript">var audioCtx = new window.AudioContext();
var audioElement = $('audio')[0];
var source = audioCtx.createMediaElementSource(audioElement);
</code></pre><p>Note here, that we need to access the zeroth element of wrapped jQuery object.</p><p><strong>Next</strong>, create an analyzer node, which can do all the cool stuff, then link it to the source node:</p><pre><code class="language-javascript">var analyser = audioCtx.createAnalyser();
source.connect(analyser);
</code></pre><p>Now, almost everything is connected. When the source variable was created, the audio context assumes that that you’re interested in doing something with the source file, such as distorting the sound, adding reverbs, etc. As such, the audio context automatically forces the audio source to not be output to the speakers, unless otherwise instructed. To ensure that the audio file still plays, <strong>connect the source to the audio context’s destination</strong>, usually speakers:</p><pre><code class="language-javascript">source.connect(audioCtx.destination);
</code></pre><p>Now everything is in place! Start getting data from the analyzer and plot them. For this example, plot the volume on the y-axis, and the frequency on the x-axis:</p><pre><code class="language-javascript">var canvas = $('canvas')[0];
var canvasCtx = canvas.getContext('2d');

var draw = function() {
  var freqDomain = new Uint8Array(analyser.frequencyBinCount);
  analyser.getByteFrequencyData(freqDomain);
  canvasCtx.clearRect(0,0,WIDTH,HEIGHT);
  for (var i = 0; i &lt; analyser.frequencyBinCount; i++) {
    var value = freqDomain[i];
    var percent = value / 256;
    var height = HEIGHT * percent;
    var offset = HEIGHT - height - 1;
    var barWidth = WIDTH/analyser.frequencyBinCount;
    var hue = i/analyser.frequencyBinCount * 360;
    canvasCtx.fillStyle = "rgb(200,0,0)";
    canvasCtx.fillRect(i * barWidth, offset, barWidth, height);
  }
  window.requestAnimationFrame(draw);
};
draw();
</code></pre><p>Hope that helps!</p><p>Check out the repo at <a href="https://github.com/kweng2/WebAudioViz">https://github.com/kweng2/WebAudioViz</a></p><p>It’s also hosted here: <a href="http://kweng2.github.io/WebAudioViz/index.html">http://kweng2.github.io/WebAudioViz/index.html</a></p></article><div class="back"> <a href="/">Back</a></div></main></body></html>