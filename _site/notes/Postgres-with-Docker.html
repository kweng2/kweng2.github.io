<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Postgres Within Docker</title><meta name="twitter:card" content="summary" /><meta name="twitter:site" content="@" /><meta name="twitter:title" content="Postgres Within Docker" /><meta name="twitter:description" content="Disclaimer!Setting up Postgres requires a user, password, and a new database. Otherwise, any server trying to connect to the database, despite correct port pointing, will not work."><meta name="description" content="Disclaimer!Setting up Postgres requires a user, password, and a new database. Otherwise, any server trying to connect to the database, despite correct port p..."><link rel="icon" href="/assets/favicon.png"><link rel="apple-touch-icon" href="/assets/touch-icon.png"><link rel="stylesheet" href="//code.cdn.mozilla.net/fonts/fira.css"><link rel="stylesheet" href="/assets/core.css"><link rel="canonical" href="/notes/Postgres-with-Docker"><link rel="alternate" type="application/atom+xml" title="Everything JS" href="/feed.xml" /></head><body><aside class="logo"> <a href="/"> <img src="http://i.imgur.com/lXpakuT.jpg?1" class="gravatar" width="80px"> </a> <span class="logo-prompt">Back to Home</span></aside><main> <noscript><style> article .footnotes { display: block; }</style></noscript><article><div class="center"><h1>Postgres Within Docker</h1><time>January 28, 2016</time></div><div class="divider"></div><h3 id="disclaimer">Disclaimer!</h3><p>Setting up Postgres requires a user, password, and a new database. Otherwise, any server trying to connect to the database, despite correct port pointing, will not work.</p><h3 id="how-to-set-up-postgres-within-docker-the-hard-way">How to Set-up Postgres within Docker The Hard Way</h3><p>Here is the Dockerfile that will create a Postgres database and set it up with user ‘docker’, password ‘docker’, and database ‘docker’.</p><p>This code block comes from <a href="https://docs.docker.com/engine/examples/postgresql_service/">docs.docker</a></p><h5 id="create-this-docker-container-from-an-existing-image-ubuntu">Create this docker container from an existing image, ubuntu:</h5><div class="highlighter-rouge"><pre class="highlight"><code>FROM ubuntu
</code></pre></div><h5 id="install-postgres">Install Postgres</h5><div class="highlighter-rouge"><pre class="highlight"><code>RUN apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys B97B0AFCAA1A47F044F244A07FCC7D46ACCC4CF8

RUN echo "deb http://apt.postgresql.org/pub/repos/apt/ precise-pgdg main" &gt; /etc/apt/sources.list.d/pgdg.list

RUN apt-get update &amp;&amp; apt-get install -y python-software-properties software-properties-common postgresql-9.3 postgresql-client-9.3 postgresql-contrib-9.3
</code></pre></div><h5 id="log-into-postgres-as-the-default-user-postgres">Log into Postgres as the default user, ‘postgres’:</h5><div class="highlighter-rouge"><pre class="highlight"><code>USER postgres
</code></pre></div><h5 id="create-a-user-named-docker-with-the-password-docker-then-create-a-database-named-docker">Create a user named ‘docker’, with the password ‘docker’, then create a database named ‘docker’:</h5><div class="highlighter-rouge"><pre class="highlight"><code>RUN    /etc/init.d/postgresql start &amp;&amp;\
    psql --command "CREATE USER docker WITH SUPERUSER PASSWORD 'docker';" &amp;&amp;\
    createdb -O docker docker
</code></pre></div><h3 id="difficulties-with-postgres-set-up">Difficulties with Postgres Set-up</h3><p>One of the most painful challenges to run into is setting up Postgres, because crushing that bug isn’t even satisfying! So here is an easy to miss step that can be a real headache to debug, step 4 outlined above.</p><h3 id="easier-solution-less-options">Easier Solution, Less Options</h3><p>So, alternatively, a Postgres docker container is already set up from the postgres image, available on <a href="https://hub.docker.com/_/postgres/">Docker Hub</a></p><p>Include it in the docker-compose.yml file:</p><div class="highlighter-rouge"><pre class="highlight"><code>postgres:
  image: postgres
</code></pre></div><p>So when <code class="highlighter-rouge">docker-compose up</code> is run, port 5432 is then exposed.</p><p>This image has configured a default user <code class="highlighter-rouge">postgres</code> with the password <code class="highlighter-rouge">mysecretpassword</code>, and a default database ‘<code class="highlighter-rouge">postgres</code>’.</p><p>Due to these pre-existing configuration, connecting an ORM to this Postgres database is as simple as specifying the connection parameters as such:</p><div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">connection</span><span class="err">:</span> <span class="p">{</span>
  <span class="nl">host</span><span class="p">:</span> <span class="s1">'postgres'</span><span class="p">,</span>
  <span class="nx">user</span><span class="err">:</span> <span class="s1">'postgres'</span><span class="p">,</span>
  <span class="nx">password</span><span class="err">:</span> <span class="s1">'mysecretpassword'</span><span class="p">,</span>
  <span class="nx">database</span><span class="err">:</span> <span class="s1">'postgres'</span><span class="p">,</span>
  <span class="nx">charset</span><span class="err">:</span> <span class="s1">'utf8'</span>
<span class="p">}</span>
</code></pre></div><h3 id="easiest-solution">Easiest Solution:</h3><p>In the docker-compose.yml file, setting these environment variables: <code class="highlighter-rouge">POSTGRES_USER</code>, <code class="highlighter-rouge">POSTGRES_PASSWORD</code>, and <code class="highlighter-rouge">POSTGRES_DB</code> will actually create a user with such username and password, as well as create a database with that name if it didn’t already exist.</p><p>Now all that’s left is using the newly assigned user, password, and database name as the connection string.</p><p>Checkout the <a href="https://hub.docker.com/_/postgres/">Postgres image</a> documentation on Docker Hub for more info.</p><p>This should alleviate some pain of trying to set up Postgres on Docker</p></article><div class="back"> <a href="/">Back</a></div></main></body></html>